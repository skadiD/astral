# GitHub Actions æ„å»ºä¼˜åŒ–æŒ‡å—

## ç£ç›˜ç©ºé—´é—®é¢˜è§£å†³æ–¹æ¡ˆ

GitHub Actions çš„ Ubuntu è¿è¡Œç¯å¢ƒç£ç›˜ç©ºé—´æœ‰é™ï¼ˆçº¦30GBï¼‰ï¼Œåœ¨æ„å»ºå¤§å‹é¡¹ç›®æ—¶å®¹æ˜“é‡åˆ°"No space left on device"é”™è¯¯ã€‚

### é—®é¢˜æ ¹æº

1. **Rustç¼–è¯‘äº§ç‰©** - Rustçš„ `target/` ç›®å½•ä¼šå ç”¨ 5-10GB
2. **Android NDK** - NDK ç¼–è¯‘ä¼šäº§ç”Ÿå¤§é‡ä¸­é—´æ–‡ä»¶
3. **Gradleç¼“å­˜** - `.gradle` ç›®å½•ä¼šä¸æ–­å¢å¤§
4. **Flutterç¼–è¯‘ç¼“å­˜** - Flutterçš„æ„å»ºç¼“å­˜ä¹Ÿå ç”¨ç©ºé—´

### è§£å†³æ–¹æ¡ˆ

#### 1. **åŠæ—¶æ¸…ç†ç¼–è¯‘äº§ç‰©** âœ… å·²å®æ–½
åœ¨æ„å»ºå®Œæˆåç«‹å³æ¸…ç†ï¼š
```yaml
- name: ğŸ§¹ æ¸…ç†Rustç¼–è¯‘äº§ç‰©ä»¥é‡Šæ”¾ç©ºé—´
  if: always()
  run: |
    rm -rf rust/target
    rm -rf android/.gradle
    rm -rf ~/.gradle
```

#### 2. **åœ¨æ„å»ºå‰æ¸…ç†** âœ… å·²å®æ–½
```yaml
- name: ğŸ› ï¸ æ„å»º universal APK
  run: |
    flutter clean
    cd rust && cargo clean && cd ..
    rm -rf android/.gradle
    flutter build apk --release
```

#### 3. **ä½¿ç”¨åˆ†ç¦»å¼æ„å»º**
ä¸åŒæ¶æ„åˆ†åˆ«æ„å»ºï¼Œé¿å…åŒæ—¶ç¼–è¯‘å¤šä¸ªæ¶æ„ï¼š
- `android-build-arm64.yaml` - ç¼–è¯‘ arm64
- `android-build-armv7.yaml` - ç¼–è¯‘ armv7
- `android-build-x86_64.yaml` - ç¼–è¯‘ x86_64
- `android-build-all.yaml` - æ„å»ºå…¨æ¶æ„ï¼ˆéœ€è¦æ›´å¤šç£ç›˜ç©ºé—´ï¼‰

#### 4. **ç›‘æ§ç£ç›˜ä½¿ç”¨**
```yaml
- name: ğŸ’¾ æ£€æŸ¥ç£ç›˜ç©ºé—´
  run: |
    echo "=== æ„å»ºå‰ç£ç›˜ç©ºé—´ ==="
    df -h
    echo "=== å¤§æ–‡ä»¶ç›®å½• ==="
    du -sh /home/runner/work/astral/astral/* 2>/dev/null | sort -rh | head -10
```

### å½“å‰ä¼˜åŒ–æªæ–½

æ‰€æœ‰Androidæ„å»ºå·¥ä½œæµå·²åŒ…å«ä»¥ä¸‹ä¼˜åŒ–ï¼š

| æ­¥éª¤ | ä½œç”¨ | æ—¶æœº |
|------|------|------|
| `flutter clean` | æ¸…ç†Flutterç¼“å­˜ | æ„å»ºå‰ |
| `cargo clean` | æ¸…ç†Rustç¼“å­˜ | æ„å»ºå‰ |
| `rm -rf android/.gradle` | åˆ é™¤Gradleç¼“å­˜ | æ„å»ºå‰ |
| `rm -rf rust/target` | åˆ é™¤Rustç¼–è¯‘äº§ç‰© | æ„å»ºå |
| `rm -rf ~/.gradle` | åˆ é™¤ç”¨æˆ·Gradleç¼“å­˜ | æ„å»ºå |
| ç£ç›˜ç©ºé—´ç›‘æ§ | è·Ÿè¸ªä½¿ç”¨æƒ…å†µ | æ„å»ºå‰å |

### æ¨èåšæ³•

#### âœ… æ¨è
```yaml
# åˆ†æ¶æ„æ„å»º
- ä½¿ç”¨ `android-build-arm64.yaml`
- ä½¿ç”¨ `android-build-armv7.yaml`
- ä½¿ç”¨ `android-build-x86_64.yaml`
# ä¼˜ç‚¹ï¼šæ¯æ¬¡æ„å»ºå ç”¨ç©ºé—´å°‘ï¼ŒæˆåŠŸç‡é«˜
```

#### âš ï¸ è°¨æ…ä½¿ç”¨
```yaml
# å…¨æ¶æ„ä¸€æ¬¡æ€§æ„å»º
- ä½¿ç”¨ `android-build-all.yaml`
# é£é™©ï¼šå¯èƒ½å¯¼è‡´ç£ç›˜ç©ºé—´ä¸è¶³
# è§£å†³ï¼šå¢åŠ æ¸…ç†æ­¥éª¤æˆ–ä½¿ç”¨æ›´å¤§çš„è¿è¡Œç¯å¢ƒ
```

### å¦‚æœä»ç„¶é‡åˆ°ç£ç›˜ç©ºé—´é—®é¢˜

1. **å¢åŠ æ¸…ç†æ­¥éª¤** - åœ¨æ„å»ºä¸­é—´æ¸…ç†æŸäº›ç›®å½•
   ```yaml
   - name: ä¸­é€”æ¸…ç†
     run: |
       rm -rf rust/target
       rm -rf ~/.cargo
   ```

2. **åˆ†æ­¥æ„å»º** - ä¸åœ¨å•ä¸ªå·¥ä½œæµä¸­æ„å»ºå¤šä¸ªæ¶æ„

3. **ä½¿ç”¨Docker** - è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰Dockeré•œåƒï¼Œé¢„ç•™æ›´å¤šç©ºé—´

4. **ä½¿ç”¨ç¼“å­˜** - GitHub Actionsæ”¯æŒç¼“å­˜å¤§æ–‡ä»¶
   ```yaml
   - uses: actions/cache@v3
     with:
       path: rust/target
       key: ${{ runner.os }}-rust-${{ hashFiles('**/Cargo.lock') }}
   ```

5. **å‡çº§è¿è¡Œç¯å¢ƒ** - ä½¿ç”¨è‡ªæ‰˜ç®¡çš„è¿è¡Œç¯å¢ƒï¼ˆéœ€è¦è‡ªå·±ç»´æŠ¤ï¼‰

### æ€§èƒ½å¯¹æ¯”

| æ–¹å¼ | ç£ç›˜å ç”¨ | æ„å»ºæ—¶é—´ | æˆåŠŸç‡ |
|------|---------|---------|--------|
| åˆ†æ¶æ„æ„å»º | ~8GB | 20-30åˆ†é’Ÿ | â­â­â­â­â­ |
| å…¨æ¶æ„æ„å»º | ~15-20GB | 40-50åˆ†é’Ÿ | â­â­â­ |
| ä½¿ç”¨ç¼“å­˜ | ~10GB | 15-25åˆ†é’Ÿ | â­â­â­â­ |

### ç›‘æ§å‘½ä»¤

åœ¨å·¥ä½œæµä¸­æ·»åŠ è¿™äº›å‘½ä»¤æ¥ç›‘æ§ç£ç›˜ä½¿ç”¨ï¼š

```bash
# æŸ¥çœ‹æ€»ä½“ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å¤§æ–‡ä»¶ç›®å½•
du -sh /* 2>/dev/null | sort -rh

# æŸ¥çœ‹ç‰¹å®šç›®å½•
du -sh /home/runner/work/astral/astral/* | sort -rh

# æŸ¥çœ‹Gradleç¼“å­˜å¤§å°
du -sh ~/.gradle

# æŸ¥çœ‹Rustç¼“å­˜å¤§å°
du -sh ~/.cargo
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-08  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šFlutter mainåˆ†æ”¯ï¼ŒRust 1.89.0
